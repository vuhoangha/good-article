/**
 * This code contains an implementation of HTML5 outlining algorithm, as described by WHATWG at [1]
 *
 * The copyright notice at [2] says:
 *		(c) Copyright 2004-2009 Apple Computer, Inc., Mozilla Foundation, and Opera Software ASA.
 *		You are granted a license to use, reproduce and create derivative works of this document.
 *
 * [1] http://www.whatwg.org/specs/web-apps/current-work/multipage/sections.html#outlines
 * [2] http://www.whatwg.org/specs/web-apps/current-work/multipage/index.html
 */
(function(){var i=function(a){this.sections=[];this.startingNode=a};i.prototype={heading:false,append:function(a){a.container=this;this.sections.push(a)},asHTML:function(a){var b=u(this.heading);if(a)b='<a href="#'+v(this.startingNode)+'">'+b+"</a>";return b+q(this.sections,a)}};var q=function(a,b){for(var f="",c=0;c<a.length;c++)f+="<li>"+a[c].asHTML(b)+"</li>";return f==""?f:"<ol>"+f+"</ol>"},r=function(a){a=a.heading;return h(a)?j(a):1},u=function(a){if(h(a)){if(k(a)=="HGROUP")a=a.getElementsByTagName("h"+
-j(a))[0];return a.textContent||a.innerText||"<i>No text content inside "+a.nodeName+"</i>"}return""+a},v=function(a){var b=a.getAttribute("id");if(b)return b;do b="h5o-"+ ++s;while(t.getElementById(b));a.setAttribute("id",b);return b},e,d,g,s,t,w=function(a,b,f){var c=a;a:for(;c;){b(c);if(c.firstChild){c=c.firstChild;continue a}for(;c;){f(c);if(c.nextSibling){c=c.nextSibling;continue a}c=c==a?null:c.parentNode}}},x=function(a){if(!h(o(g)))if(l(a)||m(a)){e!=null&&g.push(e);e=a;d=new i(a);e.outline=
{sections:[d],startingNode:a,asHTML:function(c){return q(this.sections,c)}}}else if(e!=null)if(h(a)){if(d.heading)if(j(a)>=r(n(e.outline))){var b=new i(a);e.outline.sections.push(b);d=b;d.heading=a}else{b=false;var f=d;do{if(j(a)<r(f)){b=new i(a);f.append(b);d=b;d.heading=a;b=true}f=f.container}while(!b)}else d.heading=a;g.push(a)}},y=function(a){var b=o(g);if(h(b))b==a&&g.pop();else{if((l(a)||m(a))&&!d.heading)d.heading="<i>Untitled "+k(a)+"</i>";if(l(a)&&g.length>0){e=g.pop();d=n(e.outline);for(b=
0;b<a.outline.sections.length;b++)d.append(a.outline.sections[b])}else if(m(a)&&g.length>0){e=g.pop();for(d=n(e.outline);d.sections.length>0;)d=n(d)}else if(l(a)||m(a))d=e.outline.sections[0]}},k=function(a){return a.tagName.toUpperCase()},p=function(a){return function(b){return z(b)&&(new RegExp(a,"i")).test(k(b))}},m=p("^BLOCKQUOTE|BODY|DETAILS|FIELDSET|FIGURE|TD$"),l=p("^ARTICLE|ASIDE|NAV|SECTION$"),h=p("^H[1-6]|HGROUP$"),z=function(a){return a&&a.tagName},j=function(a){var b=k(a);if(b=="HGROUP")for(b=
1;b<=6;b++){if(a.getElementsByTagName("H"+b).length>0)return-b}else return-parseInt(b.substr(1))},n=function(a){return o(a.sections)},o=function(a){return a[a.length-1]};HTML5Outline=function(a){s=0;t=a.ownerDocument||window.document;d=e=null;g=[];w(a,x,y);return e!=null?e.outline:null}})();

/*!
 * Retina.js v1.3.0
 *
 * Copyright 2014 Imulus, LLC
 * Released under the MIT license
 *
 * Retina.js is an open source script that makes it easy to serve
 * high-resolution images to devices with retina displays.
 */
(function(){function n(){}function i(e){return t.retinaImageSuffix+e}function s(e,t){this.path=e||"";if(typeof t!=="undefined"&&t!==null){this.at_2x_path=t;this.perform_check=false}else{if(undefined!==document.createElement){var n=document.createElement("a");n.href=this.path;n.pathname=n.pathname.replace(r,i);this.at_2x_path=n.href}else{var s=this.path.split("?");s[0]=s[0].replace(r,i);this.at_2x_path=s.join("?")}this.perform_check=true}}function o(e){this.el=e;this.path=new s(this.el.getAttribute("src"),this.el.getAttribute("data-at2x"));var t=this;this.path.check_2x_variant(function(e){if(e){t.swap()}})}var e=typeof exports==="undefined"?window:exports;var t={retinaImageSuffix:"@2x",check_mime_type:true,force_original_dimensions:true};e.Retina=n;n.configure=function(e){if(e===null){e={}}for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}};n.init=function(t){if(t===null){t=e}var n=t.onload||function(){};t.onload=function(){var e=document.getElementsByTagName("img"),t=[],r,i;for(r=0;r<e.length;r+=1){i=e[r];if(!!!i.getAttributeNode("data-no-retina")){t.push(new o(i))}}n()}};n.isRetina=function(){var t="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";if(e.devicePixelRatio>1){return true}if(e.matchMedia&&e.matchMedia(t).matches){return true}return false};var r=/\.\w+$/;e.RetinaImagePath=s;s.confirmed_paths=[];s.prototype.is_external=function(){return!!(this.path.match(/^https?\:/i)&&!this.path.match("//"+document.domain))};s.prototype.check_2x_variant=function(e){var n,r=this;if(this.is_external()){return e(false)}else if(!this.perform_check&&typeof this.at_2x_path!=="undefined"&&this.at_2x_path!==null){return e(true)}else if(this.at_2x_path in s.confirmed_paths){return e(true)}else{n=new XMLHttpRequest;n.open("HEAD",this.at_2x_path);n.onreadystatechange=function(){if(n.readyState!==4){return e(false)}if(n.status>=200&&n.status<=399){if(t.check_mime_type){var i=n.getResponseHeader("Content-Type");if(i===null||!i.match(/^image/i)){return e(false)}}s.confirmed_paths.push(r.at_2x_path);return e(true)}else{return e(false)}};n.send()}};e.RetinaImage=o;o.prototype.swap=function(e){function r(){if(!n.el.complete){setTimeout(r,5)}else{if(t.force_original_dimensions){n.el.setAttribute("width",n.el.style.width);n.el.setAttribute("height",n.el.style.height)}n.el.setAttribute("src",e)}}if(typeof e==="undefined"){e=this.path.at_2x_path}var n=this;r()};if(n.isRetina()){n.init(e)}})()

/* http://www.bigfootjs.com */

!function(a){a.bigfoot=function(b){var c,d=a.extend({actionOriginalFN:"hide",activateCallback:function(){},activateOnHover:!1,allowMultipleFN:!1,breakpoints:{},deleteOnUnhover:!1,hoverDelay:250,maxWidthRelativeTo:void 0,numberResetSelector:void 0,popoverDeleteDelay:300,popoverCreateDelay:100,positionContent:!0,preventPageScroll:!0,scope:!1,useFootnoteOnlyOnce:!0,contentMarkup:'<aside class="footnote-content bottom"data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="Footnote {{FOOTNOTENUM}}"><div class="footnote-main-wrapper"><div class="footnote-content-wrapper">{{FOOTNOTECONTENT}}</div></div><div class="bigfoot-tooltip"></div></aside>',buttonMarkup:'<div class=\'footnote-container\'><a href="#" class="footnote-button" id="{{SUP:data-footnote-backlink-ref}}" data-footnote-number="{{FOOTNOTENUM}}" data-footnote-identifier="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote"data-footnote-content="{{FOOTNOTECONTENT}}"><span class="footnote-circle" data-footnote-number="{{FOOTNOTENUM}}"></span><span class="footnote-circle"></span><span class="footnote-circle"></span></a></div>'},b),e={},f=function(){var b;b=d.scope?d.scope+' a[href*="#"]':'a[href*="#"]';var c,e,f=a(b).filter(function(){var b=a(this),c=b.attr("rel");return c&&"null"!=c||(c=""),(b.attr("href")+c).match(/(fn|footnote|note)[:\-_\d]/gi)&&b.closest("[class*=footnote]:not(a):not(sup)").length<1}),k=[],l=[],m=[];g(f,l),a(l).each(function(){c=a(this).attr("data-footnote-ref").replace(/[:.+~*\]\[]/g,"\\$&"),d.useFootnoteOnlyOnce&&(c+=":not(.footnote-processed)"),e=a(c).closest("li"),e.length>0&&(k.push(e.first().addClass("footnote-processed")),m.push(this))});var n,o,p,q,r,s,t,u,v,w=1;r=a("[data-footnote-identifier]:last"),q=r.length>0?+r.data("footnote-identifier"):0;for(var x=0;x<k.length;x++){p=i(a(k[x]).html().trim(),a(m[x]).data("footnote-backlink-ref")).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),q+=1,u="",s=a(m[x]),t=a(k[x]),d.numberResetSelector?(o=s.closest(d.numberResetSelector),o.is(n)?w+=1:w=1,n=o):w=q,0!==p.indexOf("<")&&(p="<p>"+p+"</p>"),u=d.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,w).replace(/\{\{FOOTNOTEID\}\}/g,q).replace(/\{\{FOOTNOTECONTENT\}\}/g,p),u=j(u,"SUP",s),u=j(u,"FN",t),v=a(u).insertBefore(s);var y=t.parent();switch(d.actionOriginalFN.toLowerCase()){case"delete":s.remove(),t.remove(),h(y);break;case"hide":s.addClass("footnote-print-only"),t.addClass("footnote-print-only"),h(y);break;case"ignore":s.addClass("footnote-print-only")}}},g=function(b,c){var d,e,f,g;b.each(function(){var b=a(this);f="#"+b.attr("href").split("#")[1],d=b.closest("sup"),e=b.find("sup"),d.length>0?(g=(d.attr("id")||"")+(b.attr("id")||""),c.push(d.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):e.length>0?(g=(e.attr("id")||"")+(b.attr("id")||""),c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):(g=b.attr("id")||"",c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f})))})},h=function(a){var b;a.is(":empty")||0===a.children(":not(.footnote-print-only)").length?(b=a.parent(),"delete"===d.actionOriginalFN.toLowerCase()?a.remove():a.addClass("footnote-print-only"),h(b)):a.children(":not(.footnote-print-only)").length==a.children("hr:not(.footnote-print-only)").length&&(b=a.parent(),"delete"===d.actionOriginalFN.toLowerCase()?a.remove():(a.children("hr").addClass("footnote-print-only"),a.addClass("footnote-print-only")),h(b))},i=function(a,b){b.indexOf(" ")>=0&&(b=b.trim().replace(/ +/g,"|").replace(/(.*)/g,"($1)"));var c=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+b+"[^>]*>(.*?)<\\s*/\\s*a>","g");return a.replace(c,"").replace("[]","")},j=function(a,b,c){var d,e,f=new RegExp("\\{\\{"+b+":([^\\}]*)\\}\\}","g");for(d=f.exec(a);d;)d[1]&&(e=c.attr(d[1])||"",a=a.replace("{{"+b+":"+d[1]+"}}",e)),d=f.exec(a);return a},k=function(b){if(d.activateOnHover){var c=a(b.target).closest(".footnote-button"),e='[data-footnote-identifier="'+c.attr("data-footnote-identifier")+'"]';if(c.hasClass("active"))return;if(c.addClass("hover-instantiated"),!d.allowMultipleFN){var f=".footnote-content:not("+e+")";s(f)}n(".footnote-button"+e).addClass("hover-instantiated")}},l=function(b){var c=a(b.target),d=c.closest(".footnote-button");$nearFootnote=c.closest(".footnote-content"),d.length>0?(b.preventDefault(),m(d)):$nearFootnote.length<1&&a(".footnote-content").length>0&&s()},m=function(a){a.blur();var b='data-footnote-identifier="'+a.attr("data-footnote-identifier")+'"';a.hasClass("changing")||(a.hasClass("active")?d.allowMultipleFN?s(".footnote-content["+b+"]"):s():(a.addClass("changing"),setTimeout(function(){a.removeClass("changing")},d.popoverCreateDelay),n(".footnote-button["+b+"]"),a.addClass("click-instantiated"),d.allowMultipleFN||s(".footnote-content:not(["+b+"])")))},n=function(b){b=b||".footnote-button";var c;c="string"!=typeof b&&d.allowMultipleFN?b:"string"!=typeof b?b.first():d.allowMultipleFN?a(b).closest(".footnote-button"):a(b+":first").closest(".footnote-button");var f=a();return c.each(function(){var b,g=a(this);try{b=d.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,g.attr("data-footnote-number")).replace(/\{\{FOOTNOTEID\}\}/g,g.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,g.attr("data-footnote-content").replace(/&gtsym;/,"&gt;").replace(/&ltsym;/,"&lt;")),b=j(b,"BUTTON",g)}finally{$content=a(b);try{d.activateCallback($content)}catch(h){}$content.insertAfter(c),e[g.attr("data-footnote-identifier")]="init",$content.attr("bigfoot-max-width",p($content.css("max-width"),$content)),$content.css("max-width",1e4);var i=$content.find(".footnote-content-wrapper");$content.attr("data-bigfoot-max-height",p(i.css("max-height"),i)),t(),g.addClass("active"),$content.find(".footnote-content-wrapper").bindScrollHandler(),f=f.add($content)}}),setTimeout(function(){f.addClass("active")},d.popoverCreateDelay),f},o=function(){var a=document.createElement("div");a.style.cssText="display:inline-block;padding:0;line-height:1;position:absolute;visibility:hidden;font-size:1em;",a.appendChild(document.createElement("M")),document.body.appendChild(a);var b=a.offsetHeight;return document.body.removeChild(a),b},p=function(a,b){return"none"==a?a=1e4:a.indexOf("rem")>=0?a=parseFloat(a)*o():a.indexOf("em")>=0?a=parseFloat(a)*parseFloat(b.css("font-size")):a.indexOf("px")>=0?a=parseFloat(a):a.indexOf("%")>=0&&(a=parseFloat(a)/100),a};a.fn.bindScrollHandler=function(){d.preventPageScroll&&a(this).on("DOMMouseScroll mousewheel",function(b){var c=a(this),d=c.scrollTop(),e=c[0].scrollHeight,f=parseInt(c.css("height")),g=c.closest(".footnote-content");if(c.scrollTop()>0&&c.scrollTop()<10&&g.addClass("scrollable"),g.hasClass("scrollable")){var h="DOMMouseScroll"==b.type?-40*b.originalEvent.detail:b.originalEvent.wheelDelta,i=h>0,j=function(){return b.stopPropagation(),b.preventDefault(),b.returnValue=!1,!1};return!i&&-h>e-f-d?(c.scrollTop(e),g.addClass("fully-scrolled"),j()):i&&h>d?(c.scrollTop(0),g.removeClass("fully-scrolled"),j()):(g.removeClass("fully-scrolled"),void 0)}})};var q=function(b){d.deleteOnUnhover&&d.activateOnHover&&setTimeout(function(){a(b.target).closest(".footnote-content, .footnote-button");a(".footnote-button:hover, .footnote-content:hover").length<1&&s()},d.hoverDelay)},r=function(a){27==a.keyCode&&s()},s=function(b,c){b=b||".footnote-content",c=c||d.popoverDeleteDelay;var f,g,h,i=a();return a(b).each(function(){h=a(this),f=h.attr("data-footnote-identifier"),g=a('.footnote-button[data-footnote-identifier="'+f+'"]'),g.hasClass("changing")||(i=i.add(g),g.removeClass("active hover-instantiated click-instantiated").addClass("changing"),h.removeClass("active").addClass("disapearing"),setTimeout(function(){h.remove(),delete e[f],g.removeClass("changing")},c))}),i},t=function(b){if(d.positionContent){var c=b?b.type:"resize";a(".footnote-content").each(function(){var b=a(this),f=b.attr("data-footnote-identifier"),g=(b.find(".footnote-content-wrapper"),b.siblings(".footnote-button")),h=v(g),i=parseFloat(b.css("margin-top")),j=+b.attr("data-bigfoot-max-height"),k=2*i+b.outerHeight(),l=1e4,m=h.bottomRoom<k&&h.topRoom>h.bottomRoom,n=e[f];if(m?("top"!=n&&(e[f]="top",b.addClass("top").removeClass("bottom"),b.css("transform-origin",100*h.leftRelative+"% 100%")),l=h.topRoom-i-15):(("bottom"!=n||"init"==n)&&(e[f]="bottom",b.removeClass("top").addClass("bottom"),b.css("transform-origin",100*h.leftRelative+"% 0%")),l=h.bottomRoom-i-15),b.find(".footnote-content-wrapper").css({"max-height":Math.min(l,j)+"px"}),"resize"==c){var o=parseFloat(b.attr("bigfoot-max-width")),p=b.find(".footnote-main-wrapper"),q=o;if(1>=o){var r=function(){var b=1e4;if(d.maxWidthRelativeTo){var c=a(d.maxWidthRelativeTo);c.length>0&&(b=c.outerWidth())}return Math.min(window.innerWidth,b)}();q=r*o}q=Math.min(q,b.find(".footnote-content-wrapper").outerWidth()+1),p.css("max-width",q+"px"),b.css({left:-h.leftRelative*q+parseFloat(g.css("margin-left"))+g.outerWidth()/2+"px"}),u(b,h.leftRelative)}parseInt(b.outerHeight())<b.find(".footnote-content-wrapper")[0].scrollHeight&&b.addClass("scrollable")})}},u=function(a,b){b=b||.5;var c=a.find(".bigfoot-tooltip");c.length>0&&c.css({left:100*b+"%"})},v=function(a){var b=parseFloat(a.css("margin-left")),c=parseFloat(a.outerWidth())-b,d=parseFloat(a.outerHeight()),e=w(),f=a.offset().top-e.scrollY+d/2,g=a.offset().left-e.scrollX+c/2;return{topRoom:f,bottomRoom:e.height-f,leftRoom:g,rightRoom:e.width-g,leftRelative:g/e.width,topRelative:f/e.height}},w=function(){return{width:window.innerWidth,height:window.innerHeight,scrollX:window.scrollX,scrollY:window.scrollY}},x=function(a,b,e,f,g){b=b||d.popoverDeleteDelay,(null===e||e!==!1)&&(e=!0);var h,i,j;if("string"==typeof a){j="iphone"===a.toLowerCase()?"<320px":"ipad"===a.toLowerCase()?"<768px":a,i=">"===j.charAt(0)?"min":"<"===j.charAt(0)?"max":null;var k=i?"("+i+"-width: "+j.substring(1)+")":j;h=window.matchMedia(k)}else h=a;if(h.media&&"invalid"===h.media)return{added:!1,mq:h,listener:null};var l="min"===i,m="max"===i;f=f||y(e,b,l,function(a){a.addClass("fixed-bottom")}),g=g||y(e,b,m,function(){});var n=function(a){a.matches?f(e,c):g(e,c)};return h.addListener(n),n(h),d.breakpoints[a]={added:!0,mq:h,listener:n},d.breakpoints[a]},y=function(a,b,c,d){return function(a,e){var f;a&&(f=e.close(),e.updateSetting("activateCallback",d)),setTimeout(function(){e.updateSetting("positionContent",c),a&&e.activate(f)},b)}},z=function(a,b){var c;if("string"==typeof a)mqFound=void 0!==d.breakpoints[a];else for(c in d.breakpoints)if(d.breakpoints.hasOwnProperty(c)&&d.breakpoints[c].mq===a){mqFound=!0;break}if(mqFound){var e=d.breakpoints[c||a];b?b({matches:!1}):e.listener({matches:!1}),e.mq.removeListener(e.listener),delete d.breakpoints[c||a]}return mqFound},A=function(a,b){var c;if("string"==typeof a)c=d[a],d[a]=b;else{c={};for(var e in a)a.hasOwnProperty(e)&&(c[e]=d[e],d[e]=a[e])}return c},B=function(a){return d[a]};return a(document).ready(function(){f(),a(document).on("mouseenter",".footnote-button",k),a(document).on("touchend click",l),a(document).on("mouseout",".hover-instantiated",q),a(document).on("keyup",r),a(window).on("scroll resize",t),a(document).on("gestureend",function(){t()})}),c={close:function(a,b){return s(a,b)},activate:function(a){return n(a)},reposition:function(){return t()},addBreakpoint:function(a,b,c,d,e){return x(a,b,c,d,e)},removeBreakpoint:function(a,b){return z(a,b)},getSetting:function(a){return B(a)},updateSetting:function(a,b){return A(a,b)}}}}(jQuery);

/*
 * www.redisgreen.net
 * Copyright 2014 Stovepipe Studios, Inc.
 */

$(function() {

  /* Set up HTML5 outline */
  var outlineDestination = $( "div.outline div" )
  if ( outlineDestination.length > 0 ) {
    outlineDestination.html(
      HTML5Outline( $( "section" )[0] ).sections[0].asHTML( true )
    );
  }

  /* Footnotes */
  $.bigfoot();

});

